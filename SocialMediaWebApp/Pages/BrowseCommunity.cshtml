@page
@model SocialMediaWebApp.Pages.BrowseCommunityModel
@{
}



	<h1> @Model.Community.CommunityName </h1>

	
@if(! Model.Community.FollowingUserIds.Contains(new Guid(User.FindFirst("UserId").Value)))
{
	<form method="post" asp-page-handler="FollowCommunity">

		<button class="btn btn-success ">
			Follow
		</button>
		<input type="hidden" name="CommunityId" value="@Model.Community.CommunityId" />
		<input type="hidden" name="CommunityName" value="@Model.Community.CommunityName" />

	</form>
}
else
{
	<form method="post" asp-page-handler="UnfollowCommunity">

		<button class="btn btn-success ">
			Unfollow
		</button>
		<input type="hidden" name="CommunityId" value="@Model.Community.CommunityId" />
		<input type="hidden" name="CommunityName" value="@Model.Community.CommunityName" />

	</form>
}

	
	<br />



	@foreach(string rule in Model.Community.Rules)
	{
		<p> @rule</p>
	}


@foreach (var post in Model.PostDtos)
{
	<br />


	<div class="PostCard">

		@if(post.IsUpvoted == false)
		{
			<form method="post" asp-page-handler="Upvote">
				<button type="submit" class="Postbutton" onclick="maintainscrollposition()" disabled="@(post.IsDownvoted)">
					Upvote
				</button>
				<input type="hidden" name="postId" value="@post.PostId" />
				<input type="hidden" name="CommunityName" value="@Model.Community.CommunityName" />
				<input type="hidden" name="direction" value="upvotePost" />
			</form>
		}
		else
		{
			<form method="post" asp-page-handler="RemoveUpvote">
				<button type="submit" class="Postbutton" onclick="maintainscrollposition()">
				   	Remove Upvote
				</button>
				<input type="hidden" name="postId" value="@post.PostId" />
				<input type="hidden" name="CommunityName" value="@Model.Community.CommunityName" />
				<input type="hidden" name="direction" value="removeUpvotePost" />
			</form>
		}

		@if(post.IsDownvoted == false)
		{
			<form method="post" asp-page-handler="Downvote">
				<button type="submit" class="Postbutton" onclick="maintainscrollposition()" disabled="@(post.IsUpvoted)">
					Downvote
				</button>
				<input type="hidden" name="postId" value="@post.PostId" />
				<input type="hidden" name="CommunityName" value="@Model.Community.CommunityName" />
				<input type="hidden" name="direction" value="downvotePost" />
			</form>
		}
		else
		{
			<form method="post" asp-page-handler="RemoveDownvote">
				<button type="submit" class="Postbutton" onclick="maintainscrollposition()" >
					Remove Downvote
				</button>
				<input type="hidden" name="postId" value="@post.PostId" />
				<input type="hidden" name="CommunityName" value="@Model.Community.CommunityName" />
				<input type="hidden" name="direction" value="removeDownvotePost" />
			</form>
		}

		<p class="PostCardScore">Score : @post.Score</p>

		<p>Community - <a asp-page="/BrowseCommunity" asp-route-CommunityName="@post.CommunityName">@post.CommunityName</a> </p>
		<p>Author - <a asp-page="/BrowseUser" asp-route-UserName="@post.Author">@post.Author</a> </p>

		<p class="PostDate"> Date - @post.DateCreated</p>
		<div class="PostCardTitle">
			<h3> @post.Title</h3>
		</div>
		@if (post.Body != "null" && post.ImageUrl == "null")
		{
			<div class="PostCardBody">
				<p> @post.Body</p>
			</div>
		}
		@if (post.Body == "null" && post.ImageUrl != "null")
		{
			<img src="@post.ImageUrl" alt="Image">


		}
		
		<div class="PostCardFooter">
			<form method="post" asp-page-handler="ViewComments">
				<button type="submit" class="CommentBoxButton">
					View comments
				</button>
				<input type="hidden" name="postId" value="@post.PostId" />
			</form>
		</div>
	</div>
	<br />
}

